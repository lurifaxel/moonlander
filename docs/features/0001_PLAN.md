# Thrust-Aligned Dust Emission

Brief: Dust should not spawn vertically below the spacecraft, but where the thruster exhaust ray meets the ground so a tilted ship kicks dust to the appropriate side.

1. `moonlander.html` (`update()` loop around the dust section)
   - Derive the engine exit point by rotating the lander's bottom-center offset `(0, lander.height / 2)` by the current `lander.angle` and translating by `(lander.x, lander.y)` so the ray starts from the nozzle instead of the craft's center.
   - Compute a normalized exhaust direction vector using the inverse of the applied thrust `(dirX, dirY) = (-Math.sin(angle), Math.cos(angle))`, which points where dust should travel.
   - March along this vector in fixed steps (reuse `terrain.step` for spacing) to find the first point where the ray intersects the terrain height sampled via `terrainY(wrapX)`, wrapping `x` into `[0, width)` for consistency with terrain sampling.
   - Stop after a sensible maximum distance (`~DUST_MAX_DIST`) so dust only appears when the beam actually reaches the surface, and return both the hit coordinates and traveled distance.

2. `moonlander.html` (`update()` dust emission block)
   - Replace the vertical-only `dist` check with the raycast result. If no hit occurs or exhaust aims upward (dirY <= 0), skip emission; otherwise use the traveled ray distance to drive proximity/intensity (e.g., normalize by `DUST_MAX_DIST`).
   - Spawn particles at the ray hit position (slightly above the terrain) so dust aligns with the imagined exhaust footprint, preserving the existing spread/alpha tuning.

3. `moonlander.html` (helpers near dust code)
   - Factor the raycast logic into a small helper (`castThrustRay` or similar) near the smoke helpers to keep `update()` readable, include inline comments summarizing the marching strategy, and reuse existing tuning constants where possible.

