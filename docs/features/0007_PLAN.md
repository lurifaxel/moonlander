# Level Editor Menu & Tools

## Context
Add a start menu so players can choose between the existing game loop and a new level editor. In the editor, players must be able to draw the ground contour with the mouse and see it fill in realtime, place the ship spawn point and the green landing zone with mouse clicks, cycle the active placement between spawn and landing via the mouse wheel, and press `R` to spawn the lander and test the custom level. The editor must support concave geometry—including enclosed caverns—so the landing zone can be placed under an overhang or inside a chamber.

## Target files & touch points
- `index.html`: owns the canvas, render loop, input listeners, terrain grid helpers (`isSolidWorld`, `groundYAt`), landing pad data, HUD, and reset logic. This file will host the new menu markup, state machine for menu/editor/test modes, editor data structures, drawing helpers, and additional input handling.
- `README.md`: describe the new menu flow and editor controls.
- `CHANGELOG.md`: document the addition of the start menu and level editor capabilities.

## Technical plan
1. **App state layering (existing work carries over)**
   - Keep the menu / play / editor / test mode helpers so we can branch logic cleanly. Update the editor activation path to initialise the new solid-voxel terrain representation instead of the legacy height map.

2. **Rich terrain data model**
   - Replace the single-height-sample terrain with a 2D solid grid (e.g. binary occupancy per cell) that supports multiple vertical spans, overhangs, and enclosed voids. Derive helper structures (edge lists / cached normals) for efficient collision checks and rendering fills.
   - Provide conversion helpers so procedural levels can still be generated from a height function into the new grid representation for "Play" mode.

3. **Editor tooling for concave geometry**
   - Rework the editor brush so it paints into the solid grid instead of adjusting a single height curve. Include additive strokes plus a modified (Alt or secondary) carve mode so players can scoop out material and form caverns. Keep realtime fill by redrawing the grid on each change.
   - Update placement logic: spawn placement clamps to empty space (find floor beneath the cursor), landing pad snaps to the first solid surface hit along a downward ray so it can sit inside caverns.

4. **Physics & collision updates**
   - Replace the `terrainY`-based foot tests with general solid collision checks. Sample contact points (feet, body, and roof) against the grid; when a point lies inside terrain, compute the local gradient (by sampling neighbouring occupancy) to push the lander outward and adjust velocities.
   - Rework landing checks to use resolved contact normals and ensure pads register even when inside caves. Maintain crash/explosion deformation by converting blasts into grid carving operations.

5. **Rendering adjustments**
   - Draw the terrain by filling the occupied grid cells (batch runs per row) so overhangs and caverns appear accurately during play and in the editor preview. Ensure bomb deformation, editor previews, and pad glow work with the new mesh.

6. **Testing loop integration**
   - Keep the `R`/`Esc` test flow but ensure resets respect the custom terrain grid. Block procedural level cycling while in custom-test mode.
   - Snapshot the editor terrain before launching a test flight and restore it after each run so craters or blast damage during testing never affect the editable baseline.

7. **Documentation & changelog**
   - Document the new editor controls (add vs carve, placing inside caves) in `README.md` and update `CHANGELOG.md` accordingly.

> Remember to add the feature to CHANGELOG.md once implementation is complete.
